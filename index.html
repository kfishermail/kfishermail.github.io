<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE html
          PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <style>
        body {
            overflow: hidden; /* Hide scrollbars */
        }

        .debug {
            visibility: hidden;
            border-radius: 4px;
            width: 150px;
        }

        button {
            /*visibility: hidden;*/
            border-radius: 4px;
            width: 150px;
        }

        .previewClass {
            visibility: hidden;
        }

        .videoClass {
            visibility: hidden;
        }

        #mainBody {
            background-image: linear-gradient(to bottom right, red, yellow);
        }

        #dialog {
            background-image: linear-gradient(to bottom right, red, yellow);
        }


        .outMessages {
            visibility: hidden;
        }

        .imgClass {
            margin: 0px;
            padding: 0px;
            position: absolute;
            /*     top: 10%;
                    left: 10%;
                    width: 30%;
                    height: 30%;
        */
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
        }

        .alertClass {
            visibility: hidden;
            font-size: 50px;
            font-weight: bold;
            background-color: tomato;
            color: white;
            border: 2px solid black;
            margin: 20px;
            padding: 20px;
            position: absolute;
            top: 100px;
            left: 50px;
            z-index: 10;
            border-radius: 25px;
        }

        /*     .imgClass {
                            margin: 0px;
                            padding: 0px;
                            position: absolute;
                            top: 200px;
                            left: 750px;
                            width: 200px;
                        }*/

        #messages {
            background-color: yellow;
            font-size: 3;
            font-weight: bold;
            line-height: 140%;
            visibility: hidden;
        }

        #status {
            background-color: red;
            font-size: 4;
            font-weight: bold;
            color: white;
            line-height: 140%;
        }
    </style>
















    <title>Stock Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>



    <!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />



    <script type="text/javascript">
        var mqtt;
        var reconnectTimeout = 2000;
        var MQTThost = "mqttbroker";
        //     var MQTThost = "broker.hivemq.com";
        var port = 8000;
        var row = 0;

        var FTPCounter = 100;
        var mqttFTP = null;
        var globalVolume = .8;
        var userName = "WebViewer"
        // mqtt user name admin password admin

        /**
* http://www.openjs.com/scripts/events/keyboard_shortcuts/
* Version : 2.01.B
* By Binny V A
* License : BSD
*/
        shortcut = {
            'all_shortcuts': {},//All the shortcuts are stored in this array
            'add': function (shortcut_combination, callback, opt) {
                //Provide a set of default options
                var default_options = {
                    'type': 'keydown',
                    'propagate': false,
                    'disable_in_input': false,
                    'target': document,
                    'keycode': false
                }
                if (!opt) opt = default_options;
                else {
                    for (var dfo in default_options) {
                        if (typeof opt[dfo] == 'undefined') opt[dfo] = default_options[dfo];
                    }
                }

                var ele = opt.target;
                if (typeof opt.target == 'string') ele = document.getElementById(opt.target);
                var ths = this;
                shortcut_combination = shortcut_combination.toLowerCase();

                //The function to be called at keypress
                var func = function (e) {
                    e = e || window.event;

                    if (opt['disable_in_input']) { //Don't enable shortcut keys in Input, Textarea fields
                        var element;
                        if (e.target) element = e.target;
                        else if (e.srcElement) element = e.srcElement;
                        if (element.nodeType == 3) element = element.parentNode;

                        if (element.tagName == 'INPUT' || element.tagName == 'TEXTAREA') return;
                    }

                    //Find Which key is pressed
                    if (e.keyCode) code = e.keyCode;
                    else if (e.which) code = e.which;
                    var character = String.fromCharCode(code).toLowerCase();

                    if (code == 188) character = ","; //If the user presses , when the type is onkeydown
                    if (code == 190) character = "."; //If the user presses , when the type is onkeydown

                    var keys = shortcut_combination.split("+");
                    //Key Pressed - counts the number of valid keypresses - if it is same as the number of keys, the shortcut function is invoked
                    var kp = 0;

                    //Work around for stupid Shift key bug created by using lowercase - as a result the shift+num combination was broken
                    var shift_nums = {
                        "`": "~",
                        "1": "!",
                        "2": "@",
                        "3": "#",
                        "4": "$",
                        "5": "%",
                        "6": "^",
                        "7": "&",
                        "8": "*",
                        "9": "(",
                        "0": ")",
                        "-": "_",
                        "=": "+",
                        ";": ":",
                        "'": "\"",
                        ",": "<",
                        ".": ">",
                        "/": "?",
                        "\\": "|"
                    }
                    //Special Keys - and their codes
                    var special_keys = {
                        'esc': 27,
                        'escape': 27,
                        'tab': 9,
                        'space': 32,
                        'return': 13,
                        'enter': 13,
                        'backspace': 8,

                        'scrolllock': 145,
                        'scroll_lock': 145,
                        'scroll': 145,
                        'capslock': 20,
                        'caps_lock': 20,
                        'caps': 20,
                        'numlock': 144,
                        'num_lock': 144,
                        'num': 144,

                        'pause': 19,
                        'break': 19,

                        'insert': 45,
                        'home': 36,
                        'delete': 46,
                        'end': 35,

                        'pageup': 33,
                        'page_up': 33,
                        'pu': 33,

                        'pagedown': 34,
                        'page_down': 34,
                        'pd': 34,

                        'left': 37,
                        'up': 38,
                        'right': 39,
                        'down': 40,

                        'f1': 112,
                        'f2': 113,
                        'f3': 114,
                        'f4': 115,
                        'f5': 116,
                        'f6': 117,
                        'f7': 118,
                        'f8': 119,
                        'f9': 120,
                        'f10': 121,
                        'f11': 122,
                        'f12': 123
                    }

                    var modifiers = {
                        shift: { wanted: false, pressed: false },
                        ctrl: { wanted: false, pressed: false },
                        alt: { wanted: false, pressed: false },
                        meta: { wanted: false, pressed: false }	//Meta is Mac specific
                    };

                    if (e.ctrlKey) modifiers.ctrl.pressed = true;
                    if (e.shiftKey) modifiers.shift.pressed = true;
                    if (e.altKey) modifiers.alt.pressed = true;
                    if (e.metaKey) modifiers.meta.pressed = true;

                    for (var i = 0; k = keys[i], i < keys.length; i++) {
                        //Modifiers
                        if (k == 'ctrl' || k == 'control') {
                            kp++;
                            modifiers.ctrl.wanted = true;

                        } else if (k == 'shift') {
                            kp++;
                            modifiers.shift.wanted = true;

                        } else if (k == 'alt') {
                            kp++;
                            modifiers.alt.wanted = true;
                        } else if (k == 'meta') {
                            kp++;
                            modifiers.meta.wanted = true;
                        } else if (k.length > 1) { //If it is a special key
                            if (special_keys[k] == code) kp++;

                        } else if (opt['keycode']) {
                            if (opt['keycode'] == code) kp++;

                        } else { //The special keys did not match
                            if (character == k) kp++;
                            else {
                                if (shift_nums[character] && e.shiftKey) { //Stupid Shift key bug created by using lowercase
                                    character = shift_nums[character];
                                    if (character == k) kp++;
                                }
                            }
                        }
                    }

                    if (kp == keys.length &&
                        modifiers.ctrl.pressed == modifiers.ctrl.wanted &&
                        modifiers.shift.pressed == modifiers.shift.wanted &&
                        modifiers.alt.pressed == modifiers.alt.wanted &&
                        modifiers.meta.pressed == modifiers.meta.wanted) {
                        callback(e);

                        if (!opt['propagate']) { //Stop the event
                            //e.cancelBubble is supported by IE - this will kill the bubbling process.
                            e.cancelBubble = true;
                            e.returnValue = false;

                            //e.stopPropagation works in Firefox.
                            if (e.stopPropagation) {
                                e.stopPropagation();
                                e.preventDefault();
                            }
                            return false;
                        }
                    }
                }
                this.all_shortcuts[shortcut_combination] = {
                    'callback': func,
                    'target': ele,
                    'event': opt['type']
                };
                //Attach the function with the event
                if (ele.addEventListener) ele.addEventListener(opt['type'], func, false);
                else if (ele.attachEvent) ele.attachEvent('on' + opt['type'], func);
                else ele['on' + opt['type']] = func;
            },

            //Remove the shortcut - just specify the shortcut and I will remove the binding
            'remove': function (shortcut_combination) {
                shortcut_combination = shortcut_combination.toLowerCase();
                var binding = this.all_shortcuts[shortcut_combination];
                delete (this.all_shortcuts[shortcut_combination])
                if (!binding) return;
                var type = binding['event'];
                var ele = binding['target'];
                var callback = binding['callback'];

                if (ele.detachEvent) ele.detachEvent('on' + type, callback);
                else if (ele.removeEventListener) ele.removeEventListener(type, callback, false);
                else ele['on' + type] = false;
            }
        }
        function f7() {
            //kennyFisher("mqtt://scrn1.png", function (png) { //startSlideShow
            //    if (png.length > 0) {
            //        var t = "data:image/png;base64," + arrayBufferToBase64(png)
            //        document.getElementById("ItemPreview").src = t;
            //        fadeNextImage(t);
            //    }
            //});
        }

        var loudClick = new Audio("data:audio/mpeg;base64,SUQzAwAAAAAAJVRQRTEAAAAbAAAAU291bmRKYXkuY29tIFNvdW5kIEVmZmVjdHP / +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");
        //var snd2orig = new Audio("data:audio/mpeg;base64,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wZ0G7jqlt/OcDIKX+/1NblSX+VKfQfP8xuJJGk7////rf////+PgXTv///1JThJJQainmySAB6imUyuVbVttUo7T4Csa821OuF88f62+CZHFnGf///mQgYIEO0SMF2NVy9NxYTdlqJ8AuS4zr//SJoTUJ+CaKKTcZvosrUPo8W/MUv0f033E9E/QpN6P///v/////WRR2mwUAYUABjabRu1vrOLKAF0kIdHjnEx/iNWo7jGn1////mApxNTJQQOU1Het/NoUFTMQs6Vja///THaGIl/0fojl8mjd/Jo8W+ZfpNpCajsz7////6kn/////WRRgDz//LD1KSTDjKOciSAKxdLx5S31uYqKIWj/+5JECgAC8V5M6g9rdFyr6Vo9rW6KtHcr5DEJQRkSpLRklSigvVc4QpmyPe9H3zHR1/in9P/8VNCMJOzYUDyVjfwHP0ZgiZt/3/+9EBnDKbegdUrckhgntHaQ9vX/X/9A/////+r/////mJ3/9ItRcoVRogAcmV9N8z0pvES8QQsKoMGXEymPQyWm6E4HQLqgpv/CZJAtYXQSwoF8e6SB56zABEoW+qgZjJAZovGr0Gl5/OjFKL3JwnaX9v7/X8y1f/////////49WAzMzEYYMZLq6CUANIqbDX7lisBIdraAEPwShTRc9WZ2vAqBc4NQ9GrUNaw0Czcrte0g1NEoiU8NFjx4NFh54FSwlOlgaCp0S3hqo8SLOh3/63f7P/KgKJxxhgGSnAFMCnIogwU5JoqBIDAuBIiNLETyFmiImtYiDTSlb8ziIFYSFv/QPC38zyxEOuPeVGHQ77r/1u/+kq49//6g4gjoVQSUMYQUSAP8PwRcZIyh2kCI2OwkZICZmaZxgnsNY8DmSCWX0idhtz3VTJSqErTSB//1X7TTTVVV//uSZB2P8xwRJ4HvYcItQlWBACM4AAABpAAAACAAADSAAAAEVf/+qCE000VVVVU0002//+qqqqummmmr///qqqppppoqqqqppppoqqATkEjIyIxBlBA5KwUEDBBwkFhYWFhUVFfiqhYWFhcVFRUVFv/Ff/xUVFRYWFpMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg==");
        var softClick = new Audio("data:audio/mpeg;base64,SUQzAwAAAAAAJVRQRTEAAAAbAAAAU291bmRKYXkuY29tIFNvdW5kIEVmZmVjdHP / +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");
        function playSoftClick() {
            //softClick.play();
            loudClick.play();
        }

        function f1() {
            SlideShowMode = false;
            playSoftClick();
            kennyFisher("mqtt://scrn1.png", function (png) {
                if (png.length > 0) {
                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                    document.getElementById("ItemPreview").src = t;
                    fadeNextImage(t);
                }
            });
        }
        function f2() {
            SlideShowMode = false;
            playSoftClick();
            kennyFisher("mqtt://scrn2.png", function (png) {
                if (png.length > 0) {
                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                    document.getElementById("ItemPreview").src = t;
                    fadeNextImage(t);
                }
            });
        }
        function f3() {
            SlideShowMode = false;
            playSoftClick();
            kennyFisher("mqtt://scrn3.png", function (png) {
                if (png.length > 0) {
                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                    document.getElementById("ItemPreview").src = t;
                    fadeNextImage(t);
                }
            });
        }
        function f4() {
            SlideShowMode = false;
            playSoftClick();
            kennyFisher("mqtt://scrn4.png", function (png) {
                if (png.length > 0) {
                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                    document.getElementById("ItemPreview").src = t;
                    fadeNextImage(t);
                }
            });
        }
        function f5() {
            sayString("Kenny Fisher Is A High Roller");
        }
        function f6() {
            playSoftClick();
            KPFSendMessage("function", "say status");
        }
        function f9() {
            playSoftClick();
            const synth = window.speechSynthesis;
            displayToast("Oh No, You Big Dummy!!!");
            playDummy();
        }
        function f10() {
            playSoftClick();
            playMafia();
        }
        shortcut.add("F1", f1);
        shortcut.add("F2", f2);
        shortcut.add("F3", f3);
        shortcut.add("F4", f4);
        shortcut.add("F5", f5);
        shortcut.add("F6", f6);
        shortcut.add("F7", f7);

        shortcut.add("F9", f9);
        shortcut.add("F10", f10);

        //////var availableVoices = ["Google US English", "Google US English Female",
        //////    "Google US English Male", "Google UK English Female",
        //////    "Google UK English Male","Microsoft Anna - English (United States)",
        //////]

        var availableVoices = ["Google US English", "Google UK English Female",
            "Google UK English Male", "Microsoft Anna - English (United States)",
        ]


        //var availableVoices = ["Google US English", "Google UK English Female",
        //     "Microsoft Anna - English (United States)",
        //]

        var voiceCounter = 0;
        var voices;
        function sayString(s) {
            if (window) {
                if ('speechSynthesis' in window) {
                    if (voices == null) {
                        voices = window.speechSynthesis.getVoices();
                    }
                    else {
                        if (voices.length == 0) {
                            voices = window.speechSynthesis.getVoices();
                        }
                    }
                    var speech = new SpeechSynthesisUtterance(s);
                    //SafeAddToListbox("Vol = " + speech.volume);
                    if (voices.length > 0) {
                        voiceCounter++;
                        if (voiceCounter >= availableVoices.length) voiceCounter = 0;
                        var voiceName = availableVoices[voiceCounter];
                        var found = false;
                        for (i = 0; i < voices.length; i++) {
                            if (voices[i].name === voiceName) {
                                speech.voice = voices[i];
                                //displayToast(voiceName);
                                found = true;
                            }
                        }
                        if (found == false) {
                            displayToast("Could Not Find:" + voiceName);
                        }
                    }

                    speech.volume = globalVolume;
                    speech.lang = 'en-US';
                    SafeAddToListbox("TTS: Calling " + s);
                    window.speechSynthesis.speak(speech);
                }
                else {
                    SafeAddToListbox("No TTS Available");
                }
            }
            else {
                SafeAddToListbox("Window is null");
            }
        }
        //"Google US English"
        //"Google US English Female"
        //"Google US English Male"
        //"Google UK English Female"
        //"Google UK English Male"
        // Microsoft Anna - English (United States)
        //////function saySomething(whatToSay) {
        //////    const synth = window.speechSynthesis;
        //////    // enter your voice here, because voices list loads asynchronously.. check the console.log below.
        //////    getVoice("Google US English", synth)
        //////        .then(voice => {
        //////            var utterThis = new SpeechSynthesisUtterance(whatToSay);
        //////            utterThis.voice = voice;
        //////            synth.speak(utterThis);
        //////        })
        //////        .catch(error => console.log("error: ", error));
        //////}

        //////function getVoice(voiceName, synth) {
        //////    var voices = window.speechSynthesis.getVoices();

        //////    for (let i = 0; i < voices.length; i++) {
        //////        SafeAddToListbox("Voice: " + voices[i].name);
        //////        //	console.log(voices[i].name)
        //////    }
        //////    ////SafeAddToListbox("In getVoice ....");
        //////    ////return new Promise((resolve, reject) => {
        //////    ////    synth.onvoiceschanged = function () {
        //////    ////        SafeAddToListbox("Changed");
        //////    ////        const voices = synth.getVoices();

        //////    ////        //		console.log("see all available languages and voices on your system: ", voices);
        //////    ////        SafeAddToListbox("Before Loop");
        //////    ////        for (let i = 0; i < voices.length; i++) {
        //////    ////            SafeAddToListbox("Voice: " + voices[i].name);
        //////    ////            //	console.log(voices[i].name)
        //////    ////            if (voices[i].name == voiceName) {
        //////    ////                resolve(voices[i]);
        //////    ////            }
        //////    ////        }
        //////    ////    }
        //////        ////synth.getVoices();
        //////    ////});
        //////}




        //const synth = window.speechSynthesis;
        //getVoice("Google US English", synth);










        var MachineID = uuidv4();
        MachineID = MachineID.substring(0, 8);

        function uuidv4() {
            return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
        }

        /**
         * Calculate a 32 bit FNV-1a hash
         * Found here: https://gist.github.com/vaiorabbit/5657561
         * Ref.: http://isthe.com/chongo/tech/comp/fnv/
         *
         * @param {string} str the input value
         * @param {boolean} [asString=false] set to true to return the hash value as
         *     8-digit hex string instead of an integer
         * @param {integer} [seed] optionally pass the hash of the previous chunk
         * @returns {integer | string}
         */
        function hashFnv32a(str, asString, seed) {
            /*jshint bitwise:false */
            var i, l,
                hval = (seed === undefined) ? 0x811c9dc5 : seed;

            for (i = 0, l = str.length; i < l; i++) {
                hval ^= str.charCodeAt(i);
                hval += (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);
            }
            if (asString) {
                // Convert to 8 digit hex string
                return ("0000000" + (hval >>> 0).toString(16)).substr(-8);
            }
            return hval >>> 0;
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        var uName = getCookie("username");

        var UniqueID = uName;;
        if (UniqueID == null || UniqueID == "") {
            var UniqueID = hashFnv32a(navigator.userAgent, true, 0);
        }
        //SafeAddToListbox(UniqueID);

        var context = new (window.AudioContext || window.webkitAudioContext)();
        var audioVolume = context.createGain();



        function isAudioRunning() {
            SafeAddToListbox("State: " + context.state);
            if (context.state == "running") return true;
            return true;
        }

        ConnectmqttFtp();

        function MQTTconnect() {
            kpfConnect(MQTThost, port, true);
        }


        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            // Update UI notify the user they can install the PWA
            //showInstallPromotion();
        });

        window.addEventListener('appinstalled', (evt) => {
            // Log install to analytics
            console.log('INSTALL: Success');
        });

        window.addEventListener('DOMContentLoaded', () => {
            let displayMode = 'browser tab';
            if (navigator.standalone) {
                displayMode = 'standalone-ios';
            }
            if (window.matchMedia('(display-mode: standalone)').matches) {
                displayMode = 'standalone';
            }
            // Log launch display mode to analytics
            console.log('DISPLAY_MODE_LAUNCH:', displayMode);
        });


        ////function displayDialog() {

        ////    $("#dialog").dialog({
        ////        autoOpen: false,
        ////        show: {
        ////            effect: "blind",
        ////            duration: 1000
        ////        },
        ////        hide: {
        ////            effect: "explode",
        ////            duration: 1000
        ////        }
        ////    });

        ////    //When the button in the form is clicked, take the input value and set that as the value of `.myTarget`
        ////    $('.formSaver').on('click', function () {
        ////        $('.myTarget').text($('.myInput').val());
        ////        $("#dialog").dialog('close');
        ////    });
        ////    SafeAddToListbox("In displayDialog");
        ////    //Open it when #opener is clicked
        ////    //$("#opener").click(function () {
        ////    //    $("#dialog").dialog("open");
        ////    //});
        ////    //MachineID;


        function displayDialog() {

            $("#dialog").dialog({
                autoOpen: false,
                width: "33%",
                maxWidth: "768px",
                show: {
                    effect: "blind",
                    duration: 1000
                },
                hide: {
                    effect: "explode",
                    duration: 1000
                }
            });

            //When the button in the form is clicked, take the input value and set that as the value of `.myTarget`
            ////$('.formSaver').on('click', function () {
            ////    $('.myTarget').text($('.myInput').val());
            ////    $("#dialog").dialog('close');
            ////});
            $('.myInput').on('change', function () {
                UniqueID = $('.myInput').val();
                document.cookie = "username=" + UniqueID + "; expires=Thu, 18 Dec 2023 12:00:00 UTC";
            });
            $('.myInput').val(UniqueID);
            SafeAddToListbox("In displayDialog");
            //Open it when #opener is clicked
            //$("#opener").click(function () {
            //    $("#dialog").dialog("open");
            //});
            $("#dialog").dialog("open");











            $("#dialog").dialog("open");
        }

        window.addEventListener('dblclick', function (e) {
            displayDialog();
        });


        window.addEventListener('load', init, false);
        function init() {
            MQTTconnect();
        }
        //////document.addEventListener("keydown", event => {
        //////    SafeAddToListbox("KEY: " + event.key);
        //////    switch (event.key) {
        //////        case 'F8':
        //////            kennyFisher("mqtt://scrn1.png", function (png) { //startSlideShow
        //////                if (png.length > 0) {
        //////                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
        //////                    document.getElementById("ItemPreview").src = t;
        //////                    fadeNextImage(t);
        //////                }
        //////            });
        //////            break;
        //////        case 'F9':
        //////            kennyFisher("mqtt://scrn2.png", function (png) { //startSlideShow
        //////                if (png.length > 0) {
        //////                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
        //////                    document.getElementById("ItemPreview").src = t;
        //////                    fadeNextImage(t);
        //////                }
        //////            });
        //////            break;
        //////        case 'F10':
        //////            kennyFisher("mqtt://scrn3.png", function (png) { //startSlideShow
        //////                if (png.length > 0) {
        //////                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
        //////                    document.getElementById("ItemPreview").src = t;
        //////                    fadeNextImage(t);
        //////                }
        //////            });
        //////            break;
        //////    }
        //////    //alert(event.keyCode)
        //////    //	if (event.isComposing || event.keyCode === 115) {
        //////    //		return;
        //////    //	}
        //////    // do something
        //////});


        function onConnectionLost(reason) {
            SafeAddToListbox("Connection Lost" + reason.errorMessage);
            //document.getElementById("status_messages").innerHTML = "Connection Lost" + reason.errorMessage;
            setTimeout(MQTTconnect, reconnectTimeout);
        }
        function onFailure(message) {
            SafeAddToListbox("Connection Failure");
            //document.getElementById("status_messages").innerHTML = "Connection Failed- Retrying";
            setTimeout(MQTTconnect, reconnectTimeout);
        }
        function onConnect() {
            // Once a connection has been made, make a subscription and send a message.
            //document.getElementById("status_messages").innerHTML = "Connected to " + host + " on port " + port;
            //console.log("on Connect ");
            SafeAddToListbox("1. System Is Now Connected!!!!!!!!!!!!!!!!!!");
            //kpfSubscribe()
            //function kpfSubscribe() {
            var soptions = {
                qos: 1,
            };
            //subscribe([("my/topic", 0), ("another/topic", 2)])
            //mqtt.subscribe("#", soptions);
            mqtt.subscribe("kenny_fisher/#", soptions);
            //}

        }


        function onConnected(recon, url) {
            SafeAddToListbox("2. System Is Now Connected!!!!!!!!!!!!!!!!!!" + recon);
        }
        //////function disconnect() {
        //////    if (connected_flag == 1)
        //////        mqtt.disconnect();
        //////}
        function displayMessage(s) {
            s = s + "</br>";
            try {
                document.getElementById("out_messages").innerHTML += s;
            }
            catch (err) {
                document.getElementById("out_messages").innerHTML = err.message;
            }

            if (row > 15) {
                row = 1;
                document.getElementById("out_messages").innerHTML = s;
            }
            else
                row += 1;
        }

        function onMessageArrived(r_message) {
            parseMQTT(r_message);
        }



        function kpfConnect(host, port, clean_sessions) {
            var clientID = "web" + new Date().getTime();
            mqtt = new Paho.MQTT.Client(host, port, clientID);
            var options = {
                timeout: 3,
                cleanSession: clean_sessions,
                onSuccess: onConnect,
                onFailure: onFailure,
            };
            mqtt.onConnectionLost = onConnectionLost;
            mqtt.onMessageArrived = onMessageArrived;
            mqtt.onConnected = onConnected;
            SafeAddToListbox("Starting mqtt Connect");
            mqtt.connect(options);
            return false;
        }



        function ConnectmqttFtp() {
            var clientID = "web" + new Date().getTime();
            mqttFTP = new Paho.MQTT.Client(MQTThost, port, clientID);


            // ------------------------
            var dest = "";
            mqttFTP.onMessageArrived = function (r_message) {
                SafeAddToListbox("Got ftpresponse Message");
                var subTopics = r_message.destinationName.split("/");
                for (i = 0; i < callbackArray.length; i++) {
                    if (callbackArray[i].response == r_message.destinationName) {
                        SafeAddToListbox("Got Match");
                        var tElement = callbackArray[i];
                        callbackArray.splice(i, 1);
                        var bytes = r_message.payloadBytes
                        tElement.callback(bytes);
                    }
                }
            }


            //----------------------------------------






            var connectOptions = {
                timeout: 3,
                cleanSession: true,
                onSuccess: function (m) {
                    SafeAddToListbox("mqttFTP - In Connect onSuccess: " + mqttFTP.isConnected());
                    var suboptions = {
                        qos: 1,
                        onSuccess: function () {
                            displayToast("Double-Click For Menu");
                            kennyFisher("mqtt://scrn2.png", function (png) {
                                if (png.length > 0) {
                                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                                    document.getElementById("ItemPreview").src = t;
                                    fadeNextImage(t);
                                }
                            });
                            SafeAddToListbox("mqttFTP - In Subscribe onSuccess 3 mqttFTP");
                        }
                    };
                    //SafeAddToListbox("Subscribe To ftpresponse");
                    mqttFTP.subscribe("ftpresponse/" + MachineID + "/#", suboptions);
                },// onConnectedFTP,
                onFailure: function (m) {
                    //SafeAddToListbox("onFailure Error");
                    //console.log("KPF Failure In FTP Connect")
                },
            };
            try {
                SafeAddToListbox("Starting Connect Process");
                mqttFTP.onFailure = function () { alert("Error"); };


                mqttFTP.onConnectionLost = function (eObj) {
                    SafeAddToListbox("Lost Connection: " + eObj.errorMessage);
                    setTimeout(ConnectmqttFtp, reconnectTimeout);
                };
                mqttFTP.onConnected = function () { alert("Connected"); };

                mqttFTP.connect(connectOptions);
            }
            catch (err) {
                SafeAddToListbox("ERROR" + err.message);
                document.getElementById("out_messages").innerHTML = err.message;
            }
            //mqttFTP.connect(connectOptions);
            ////console.log("Waiting For Connection");
            SafeAddToListbox("Returning");
        }



        var Image1Visible = true;
        function fadeNextImage(tImg) {
            document.getElementById("ItemPreview").src = tImg;
            if (Image1Visible) {
                Image1Visible = false;
                document.getElementById("picTwo").src = tImg;

                $('#picTwo').fadeIn(1500);
                $('#picOne').delay(500).fadeOut(1500);
            } else {
                Image1Visible = true;
                document.getElementById("picOne").src = tImg;

                $('#picOne').fadeIn(1500);
                $('#picTwo').delay(500).fadeOut(1500);
            }
        }





        function displayToast(msg) {
            //SafeAddToListbox("Got Toast: " + msg);
            if (msg.replaceAll == null) {
                SafeAddToListbox("Could Not Find replaceAll");
            }
            else {
                msg = msg.replaceAll("\n", "</br>");
            }
            var element = document.getElementById('alrt');
            if (element != null) {
                //SafeAddToListbox("Toast 1");
                if (element.style.visibility == 'visible') {
                    element.innerHTML += '</br></br><b>' + msg + '</b>';
                }
                else {
                    element.innerHTML = '<b>' + msg + '</b>';
                }
                //element.innerHTML = '<b>' + msg + '</b>';
                element.style.visibility = 'visible';
                setTimeout(function () {
                    element.innerHTML = '';
                    element.style.visibility = 'hidden';
                }, 5000);
            }
            else {
                SafeAddToListbox("Element is null");
            }
        }


        function arrayBufferToBase64(buffer) {
            var binary = '';
            var bytes = new Uint8Array(buffer);
            var len = bytes.byteLength;
            for (var i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }




        function KPFSendMessage(topic, msg) {
            //return;
            message = new Paho.MQTT.Message(msg);
            message.destinationName = topic;
            message.qos = 1;
            message.retained = false;
            mqtt.send(message);
        }







        function playMp3Buffer(mbuffer) {
            //return;
            SafeAddToListbox("in playMp3Buffer: " + mbuffer.length);

            // Decode asynchronously

            SafeAddToListbox("Start playMp3Buffer onLoad");
            context.decodeAudioData(mbuffer,
                function (buffer) {
                    SafeAddToListbox("Got Data Len: " + buffer.length);
                    playSound(buffer);
                },
                function (e) {
                    SafeAddToListbox("Got Error: " + e.err);
                }
            );
        }


        //chrome --user-data-dir=$(mktemp -d) --kiosk
        //--autoplay-policy=no-user-gesture-required
        //or
        //--no-user-gesture-required
        //    C:\Users\kenny\AppData\Local\Google\Chrome\Application\chrome_proxy.exe
        //    C:\Users\kenny\AppData\Local\Google\Chrome\Application\chrome.exe
        //    --no-user-gesture-required
        //  --kiosk

        //   You can disable entirely the autoplay policy by using an
        //internal switch with
        // chrome.exe --autoplay-policy=no-user-gesture-required.
        //This allows you to test your website as if user were strongly
        //engaged with your site and playback autoplay would be always allowed.
        function playSound(buffer) {
            context.resume();
            if (isAudioRunning() == false) {
                displayToast("Audio Not Active!!");
            }
            else {
                context.resume();
                var st = context.state;
                SafeAddToListbox("Audio State: " + st);
                if (st != "running") {
                    displayToast("Audio Disabled, Click Anywhere To Enable");
                }

                var source = context.createBufferSource(); // creates a sound source
                source.buffer = buffer;                    // tell the source which sound to play


                audioVolume.connect(context.destination);

                source.connect(audioVolume);
                audioVolume.connect(context.destination);
                //source.connect(context.destination);       // connect the source to the context's destination (the speakers)
                source.start(0);                           // play the source now

                // note: on older systems, may have to use deprecated noteOn(time);
            }
        }



        function byteToUint8Array(byteArray) {
            var uint8Array = new Uint8Array(byteArray.length);
            for (var i = 0; i < uint8Array.length; i++) {
                uint8Array[i] = byteArray[i];
            }
            return uint8Array.buffer;
        }

        // if mqtt specified, everything OK, send to mqttBroker
        // if http specified
        //    if running as a file:
        //      prepend mqtt://, and send to mqttBroker
        //    if running with server
        //      prepend mqtt://, and send to mqttBroker
        // if neither specified

        //    if running as a file
        //      prepend mqtt://, and send to mqttBroker
        //    if running with server
        //
        // edit - send to web server
        //
        //      prepend mqtt://, and send to mqttBroker
        //The only way out of kiosk mode is Alt + F4










        //SafeAddToListbox("YES, Got ftpresponse message");
        ////var sourceTopics = dest.split("/");

        ////if (subTopics[2] == sourceTopics[2]) {
        ////    var bytes = r_message.payloadBytes
        ////    SafeAddToListbox("Got Match !!!!!!!!!!!!!!!!!!!");
        ////    SafeAddToListbox("Calling Callback, Len: " + bytes.length);
        ////    if (bytes.length == 0) {
        ////        SafeAddToListbox("---------------   FTP Response  Length == 0 -------------")
        ////    }
        ////    callback(bytes)
        ////}
        ////else {
        ////    SafeAddToListbox("No Match - MS: " + subTopics[2] + " ME: " + sourceTopics[2]);
        ////}









        function GetMQTTFile(fName, callback) {
            if (mqttFTP == null) {
                SafeAddToListbox("mqttFTP = null");
                return;
            }
            if (mqttFTP.isConnected() == false) {
                SafeAddToListbox("mqttFTP not connected");
                return;
            }
            if (fName.startsWith("mqtt://")) {
                fName = fName.substring(7);
            }
            ////var dest = "";
            ////mqttFTP.onMessageArrived = function (r_message) {
            ////    SafeAddToListbox("Got Message");
            ////    var subTopics = r_message.destinationName.split("/");
            ////    switch (subTopics[0]) {
            ////        case "ftpresponse":
            ////            //SafeAddToListbox("YES, Got ftpresponse message");
            ////            var sourceTopics = dest.split("/");

            ////            if (subTopics[2] == sourceTopics[2]) {
            ////                var bytes = r_message.payloadBytes
            ////                SafeAddToListbox("Got Match !!!!!!!!!!!!!!!!!!!");
            ////                SafeAddToListbox("Calling Callback, Len: " + bytes.length);
            ////                if (bytes.length == 0) {
            ////                    SafeAddToListbox("---------------   FTP Response  Length == 0 -------------")
            ////                }
            ////                callback(bytes)
            ////            }
            ////            else {
            ////                SafeAddToListbox("No Match - MS: " + subTopics[2] + " ME: " + sourceTopics[2]);
            ////            }
            ////            break;
            ////    }
            ////};
            var message = new Paho.MQTT.Message(fName);
            FTPCounter++;
            SafeAddToListbox("Get File: " + fName);
            dest = "ftprequest/" + MachineID + "/" + FTPCounter + "/" + fName;



            var tEntry = {}
            tEntry.response = "ftpresponse/" + MachineID + "/" + FTPCounter + "/" + fName;
            tEntry.callback = callback;
            callbackArray.push(tEntry);


            SafeAddToListbox("Sent: " + dest);
            message.destinationName = dest;
            message.qos = 1;
            message.retained = false;
            mqttFTP.send(message);
        }

        var callbackArray = [];


        function kennyFisher(url, callback) {
            //return;
            SafeAddToListbox("in kennyFisher: " + url);
            if (url.startsWith("mqtt://") == false) {
                url = "mqtt://" + url;
            }

            GetMQTTFile(url, function (png) {
                SafeAddToListbox("1. In Callback Kenny Fisher: " + png.length);
                if (png.length == 0) {
                    SafeAddToListbox("************************** Len: 0 **************************");
                }
                callback(png);
            });
        }

        function playURL(url) {
            //return;
            SafeAddToListbox("in playURL: " + url);
            //--------
            //if (url.startsWith("mqtt://") == false) {
            //    url = "mqtt://" + url;
            //}
            ////kennyFisher(url);
            kennyFisher(url, function (png) { //playURL
                SafeAddToListbox("2. In Callback PlayURL    Len: " + png.length);
                if (png.length > 0) {
                    var buff = byteToUint8Array(png)
                    context.decodeAudioData(buff,
                        function (buffer) {
                            SafeAddToListbox("Got Data Len: " + buffer.length);
                            playSound(buffer);
                        },
                        function (e) {
                            SafeAddToListbox("Got Error PlayURL: " + e.err);
                        }

                    );
                }
            });
            // ---------
        }

        var SlideShowMode = false;
        //clearTimeout TimeoutReference
        var TimeoutReference = null;
        function startSlideShow(reset) {
            SlideShowMode = true;
            if (reset) slideShowIndex = 0;
            if (TimeoutReference != null) {
                clearTimeout(TimeoutReference);
            }
            if (slideShowIndex >= SlideShowList.length) {
                slideShowIndex = 0;
            }

            var fName = SlideShowList[slideShowIndex].URL;
            if (true || fName.startsWith("mqtt://")) {
                kennyFisher(fName, function (png) { //startSlideShow
                    if (png.length > 0) {
                        var t = "data:image/png;base64," + arrayBufferToBase64(png)
                        document.getElementById("ItemPreview").src = t;
                        fadeNextImage(t);
                    }
                });
            }
            slideShow();
        }

        function slideShow() {
            if (SlideShowMode) {
                TimeoutReference = setTimeout(function () {
                    if (SlideShowMode) {
                        slideShowIndex++;
                        if (slideShowIndex >= SlideShowList.length) {
                            slideShowIndex = 0;
                        }
                        var fName = SlideShowList[slideShowIndex].URL;
                        if (fName.startsWith("mqtt://")) {
                            kennyFisher(fName, function (png) { //slideShow
                                if (png.length > 0) {
                                    var t = "data:image/png;base64," + arrayBufferToBase64(png)
                                    fadeNextImage(t);
                                }
                            });
                        }
                        else if (fName.startsWith("http://")) { // setting src to url
                            fadeNextImage(fName);
                        }
                        // ----------------
                        slideShow();
                    }
                }, SlideShowList[slideShowIndex].TimeSecs * 1000)
            }
        }

        var ImageSwitcher1 = {}
        var slideShowIndex = 0;
        var SlideShowList = [];



        function _base64ToArrayBuffer(base64) {
            var binary_string = window.atob(base64);
            var len = binary_string.length;
            var bytes = new Uint8Array(len);
            for (var i = 0; i < len; i++) {
                bytes[i] = binary_string.charCodeAt(i);
            }
            return bytes.buffer;
        }







        function parseMQTT(r_message) {
            //return;
            if (r_message.destinationName.includes("ping") == false) {
                SafeAddToListbox("In parseMQTT: " + r_message.destinationName);
            }
            //return;
            var topicParts = r_message.destinationName.split("/");
            var Command = topicParts[topicParts.length - 1];//.ToLower();

            if (false) {
            }
            else if (Command == 'query') {
                var q = {};
                q.MachineName = "PWATester";
                q.HostName = location.hostname;
                var json = JSON.stringify(q);
                KPFSendMessage("kenny_fisher/sounds/*/queryresponse", json);
            }
            else if (Command == "toast") {
                SafeAddToListbox("Got Toast Message");
                //return;
                displayToast(r_message.payloadString);
            }

            else if (Command == "newaudio") {
                //return;
                SafeAddToListbox("Got NewAudio");
                //return;
                var response = JSON.parse(r_message.payloadString);

                if (response.stopall != null) {
                    if (response.stopall == true) {
                        stopAudio();
                    }
                }


                if (response.url != null) {
                    var url = response.url;
                    SafeAddToListbox("Playing URL: " + url);
                    if (url != null && url.length > 0) {
                        //SafeAddToListbox("Calling playURL");
                        playURL(url);
                    }
                    else {
                        SafeAddToListbox("NULL");
                        stopAudio();
                    }
                }
                else if (response.say != null) {
                    var sStr = response.say;
                    SafeAddToListbox("TTS: " + sStr);
                    sayString(sStr);
                    //////if (window) {
                    //////    if ('speechSynthesis' in window) {
                    //////        var speech = new SpeechSynthesisUtterance(SayString2);
                    //////        //SafeAddToListbox("Vol = " + speech.volume);
                    //////        speech.volume = globalVolume;
                    //////        speech.lang = 'en-US';
                    //////        SafeAddToListbox("TTS: Calling " + SayString2);
                    //////        window.speechSynthesis.speak(speech);
                    //////    }
                    //////    else {
                    //////        SafeAddToListbox("No TTS Available");
                    //////    }
                    //////}
                    //////else {
                    //////    SafeAddToListbox("Window is null");
                    //////}
                }
                else if (response.binary != null) {
                    var bindata = response.binary;
                    if (bindata.data != null) {
                        bindata = bindata.data;
                    }
                    SafeAddToListbox("Bindata length: " + bindata.length);
                    var aType = typeof bindata;
                    var ABuffer;
                    if (aType == 'object') {
                        ABuffer = byteToUint8Array(bindata);
                    }
                    else if (aType == 'string') {
                        var B64String = bindata;
                        ABuffer = _base64ToArrayBuffer(B64String);
                    }
                    playMp3Buffer(ABuffer);
                }
            }
            else if (Command == "increasevolume") {
                volumeUp();
            }
            else if (Command == "decreasevolume") {
                volumeDown();
            }


            else if (Command == "sliderefresh") {
                startSlideShow(false);
            }
            else if (Command == "slidepause") {
                SafeAddToListbox("Pause Slideshow");
                if (TimeoutReference != null) {
                    SafeAddToListbox("Clear Timeout ");
                    clearTimeout(TimeoutReference);
                }
            }

            else if (Command == "stopslideshow") {
                SafeAddToListbox("Stop Slideshow");
                SlideShowMode = false;
                if (TimeoutReference != null) {
                    clearTimeout(TimeoutReference);
                }
            }
            else if (Command == "slidenext") {
                slideShowIndex++;
                startSlideShow(false);
            }
            else if (Command == "newimage") {
                //return;
                ImageSwitcher1.AnimatedTransition = false;
                ImageSwitcher1.FadedTransition = false;
                var response = JSON.parse(r_message.payloadString);
                SlideShowList = [];
                if (response.fade != null) {
                    if (response.fade == true) {
                        ImageSwitcher1.FadedTransition = true;
                    }
                }
                if (response.animate != null) {
                    if (response.animate == true) {
                        ImageSwitcher1.AnimatedTransition = true;
                    }
                }
                //return;
                if (response.images != null) {
                    for (var item of response.images) {
                        var SSE = {};
                        SSE.URL = item.url;
                        if (item.time != null) {
                            SSE.TimeSecs = item.time;
                        }
                        else {
                            SSE.TimeSecs = 0;
                        }
                        if (SSE.TimeSecs == 0) {
                            SSE.TimeSecs = MAX_SAFE_INTEGER;
                        }
                        SlideShowList.push(SSE);
                    }
                    startSlideShow(true);
                }
                else if (response.binary != null) {
                    var idata = response.binary;
                    if (idata.data != null) {
                        SafeAddToListbox("Changing idata to idata.data");
                        idata = idata.data;
                    }
                    var iType = typeof idata;
                    SafeAddToListbox("Display idata length: " + idata.length + " Type: " + iType);
                    if (idata.length > 0) {
                        var t;
                        if (iType == 'object') {
                            t = "data:image/png;base64," + arrayBufferToBase64(idata);
                        }
                        else if (iType == 'string') {
                            t = "data:image/png;base64," + idata;
                        }
                        fadeNextImage(t);
                    }
                }
            }
            else {
                //       SafeAddToListbox("Unknown MQTT Command: " + Command);
            }
        }



        //////try {
        //////    var idata = response.binary;
        //////    var dType = idata.GetType();
        //////    if (dType.Name == "JValue") {
        //////        //string hhhh = idata;
        //////        //imageBytes = Convert.FromBase64String(hhhh);
        //////        imageBytes = Convert.FromBase64String((string)idata);
        //////    }
        //////    else {
        //////        JArray jData = idata;
        //////        var tSbyte = jData.ToObject<sbyte[]>();
        //////        imageBytes = (byte[])(Array)tSbyte;
        //////    }
        //////}
        //////catch (Exception ex)
        //////{
        //////    //string base64 = response.binary;
        //////    //byte[] bytes = response.binary;
        //////}





        //function arrayBufferToBase64(buffer) {
        //    var binary = '';
        //    var bytes = new Uint8Array(buffer);
        //    var len = bytes.byteLength;
        //    for (var i = 0; i < len; i++) {
        //        binary += String.fromCharCode(bytes[i]);
        //    }
        //    return window.btoa(binary);
        //}

        ////function _base64ToArrayBuffer(base64) {
        ////    var binary_string = window.atob(base64);
        ////    var len = binary_string.length;
        ////    var bytes = new Uint8Array(len);
        ////    for (var i = 0; i < len; i++) {
        ////        bytes[i] = binary_string.charCodeAt(i);
        ////    }
        ////    return bytes.buffer;
        ////}


        ////for (var item of response.images) {
        ////    var SSE = {};
        ////    SSE.URL = item.url;
        ////    if (item.time != null) {
        ////        SSE.TimeSecs = item.time;
        ////    }
        ////    else {
        ////        SSE.TimeSecs = 0;
        ////    }
        ////    if (SSE.TimeSecs == 0) {
        ////        SSE.TimeSecs = MAX_SAFE_INTEGER;
        ////    }
        ////    SlideShowList.push(SSE);


        /*


                    else if (Command == "newvideo") {
                    }
                    else if (Command.startsWith("slideshow")) {
                        GotoSlideshowMode(SlideShowList);
                    }
                    else if (Command == "sunclock") {
                        SlideShowMode = false;
                        StopVideo();
                        ShowSunclock();
                        ScreenState = ScreenStateEnum.SUNCLOCK;
                    }



                    else if (Command == "playvideo") {
                        SafeAddToListbox("Got playvideo");
                        SlideShowMode = false;

                        var vName = System.Text.Encoding.UTF8.GetString(e.Message);
                        StartVideo(vName);
                        ScreenState = ScreenStateEnum.VIDEO;
                    }
                    else if (Command == "stopvideo") {
                        SlideShowMode = false;
                        SafeAddToListbox("Got Stop");
                        StopVideo();
                    }

                    else if (Command == "exit") {
                        if (Environment.MachineName.ToLower().startsWith("debian")) {
                            Application.Exit();
                        }
                    }
                    else if (Command == "clear") {
                        SlideShowMode = false;
                        StopVideo();
                        Clear();
                    }
                    else if (Command == "hide") {
                        SlideShowMode = false;
                        HideAll();
                    }

                    //////else if (topicParts[topicParts.Length - 1].ToLower() == "stopaudio")
                    //////{
                    //////    __BassFunctions.StopAllChannels();
                    //////}



        */












        var ftpCounter = 100;
        function SafeAddToListbox(s) {
            try {
                s = ftpCounter + " " + s;
                ftpCounter++;
                KPFSendMessage("safeadd/" + UniqueID + "/webviewer", s);
                console.log(s);
                displayMessage(s);
                //document.getElementById("status").innerHTML = s;
                //document.getElementById("status_messages").innerHTML = s;
            }
            catch (err) {
                //document.getElementById("out_messages").innerHTML = err.message;
            }
        }




        function playDummy() {
            //playURL("dummy.mp3");
            //playURL("http://mqttbroker:81/sda1/dummy.mp3");
            playSoftClick();
            playURL("d:\\dummy.mp3");
        }
        function playCorona() {
            playSoftClick();
            playURL("d:\\corona.mp3");
        }
        function volumeDown() {
            playSoftClick();
            var vid = document.getElementById("myVideo");
            globalVolume = globalVolume - 0.1;
            if (globalVolume < 0.0) globalVolume = 0.0;
            audioVolume.gain.value = globalVolume;
            vid.volume = globalVolume;
        }
        function volumeUp() {
            playSoftClick();
            var vid = document.getElementById("myVideo");
            globalVolume = globalVolume + 0.1;
            if (globalVolume > 1.0) globalVolume = 1.0;
            audioVolume.gain.value = globalVolume;
            vid.volume = globalVolume;
        }
        function displaySlideshow() {
            SafeAddToListbox("Start SlideShow");
            playSoftClick();

            SlideShowList = [];
            var SSE = {}; SSE.URL = "mqtt://scrn1.png"; SSE.TimeSecs = 5;
            SlideShowList.push(SSE);
            var SSE = {}; SSE.URL = "mqtt://scrn2.png"; SSE.TimeSecs = 5;
            SlideShowList.push(SSE);
            var SSE = {}; SSE.URL = "mqtt://scrn3.png"; SSE.TimeSecs = 5;
            SlideShowList.push(SSE);
            var SSE = {};
            SSE.URL = "mqtt://scrn4.png"; SSE.TimeSecs = 5;
            SlideShowList.push(SSE);
            startSlideShow(true);
            //var vid = document.getElementById("myVideo");
            // globalVolume = globalVolume + 0.1;
            // if (globalVolume > 1.0) globalVolume = 1.0;
            // audioVolume.gain.value = globalVolume;
            // vid.volume = globalVolume;
        }
        function stopAudio() {
            playSoftClick();
            context.close();
            context = new (window.AudioContext || window.webkitAudioContext)();
            audioVolume = context.createGain();
            //var x = document.cookie;
            //displayToast(x);
        }

        function startConnect() {
            kpfConnect(MQTThost, port, true);
        }

        function getMqttBinary() {
            playSoftClick();
            SafeAddToListbox("In getMqttBinary onSuccess: " + mqttFTP.isConnected());
            //kpfConnect("mqttbroker", port, true);
            SafeAddToListbox("In getMqttBinary");
            GetMQTTFile("mqtt://d:\\Dummy.mp3", function (bindata) {
                SafeAddToListbox("In getMqttBinary Callback");
                var ABuffer = byteToUint8Array(bindata);
                playMp3Buffer(ABuffer);
            });
            SafeAddToListbox("Done getMqttBinary ----------------------------");
        }

        function displayConnections() {
            playSoftClick();
            var oStr = "mqtt: ";
            if (mqtt.isConnected() == true) {
                oStr += "Connected";
            }
            else {
                oStr += "Not Connected";
            }
            oStr += "\nmqttFTP: ";
            if (mqttFTP.isConnected() == true) {
                oStr += "Connected";
            }
            else {
                oStr += "Not Connected";
            }
            oStr += "\nHost: " + location.hostname;
            oStr += "\nAudio State: " + context.state;
            context.resume();
            oStr += "\nAudio State: " + context.state;
            displayToast(oStr);
            SafeAddToListbox("Trying");
            var result = navigator.userAgent;
            SafeAddToListbox(result);
            //document.cookie = "username=John Doe; expires=Thu, 18 Dec 2023 12:00:00 UTC";
        }

        function displaySpreadsheet() {

            playSoftClick();

            SlideShowList = [];
            var SSE = {}; SSE.URL = "mqtt://scrn1.png"; SSE.TimeSecs = 60;
            SlideShowList.push(SSE);
            startSlideShow(true);



            //SlideShowMode = false;
            //playSoftClick();
            //kennyFisher("mqtt://scrn1.png", function (png) { //startSlideShow
            //    if (png.length > 0) {
            //        var t = "data:image/png;base64," + arrayBufferToBase64(png)
            //        document.getElementById("ItemPreview").src = t;
            //        fadeNextImage(t);
            //    }
            //});
        }
        function displayGauges() {
            playSoftClick();
            SlideShowList = [];
            var SSE = {}; SSE.URL = "mqtt://scrn2.png"; SSE.TimeSecs = 60;
            SlideShowList.push(SSE);
            startSlideShow(true);

            ////SlideShowMode = false;
            ////playSoftClick();
            ////kennyFisher("mqtt://scrn2.png", function (png) {
            ////    if (png.length > 0) {
            ////        var t = "data:image/png;base64," + arrayBufferToBase64(png)
            ////        document.getElementById("ItemPreview").src = t;
            ////        fadeNextImage(t);
            ////    }
            ////});
        }
        function displayOverview() {
            playSoftClick();
            SlideShowList = [];
            var SSE = {}; SSE.URL = "mqtt://scrn3.png"; SSE.TimeSecs = 60;
            SlideShowList.push(SSE);
            startSlideShow(true);


            ////SlideShowMode = false;
            ////playSoftClick();
            ////kennyFisher("mqtt://scrn3.png", function (png) {
            ////    if (png.length > 0) {
            ////        var t = "data:image/png;base64," + arrayBufferToBase64(png)
            ////        document.getElementById("ItemPreview").src = t;
            ////        fadeNextImage(t);
            ////    }
            ////});
        }
        function displayIndexes() {
            playSoftClick();
            SlideShowList = [];
            var SSE = {}; SSE.URL = "mqtt://scrn4.png"; SSE.TimeSecs = 60;
            SlideShowList.push(SSE);
            startSlideShow(true);


            ////SlideShowMode = false;
            ////playSoftClick();
            ////kennyFisher("mqtt://scrn4.png", function (png) { //startSlideShow
            ////    if (png.length > 0) {
            ////        var t = "data:image/png;base64," + arrayBufferToBase64(png)
            ////        document.getElementById("ItemPreview").src = t;
            ////        fadeNextImage(t);
            ////    }
            ////});
        }
        function sayCondition() {
            playSoftClick();
            KPFSendMessage("function", "say status");
        }

    </script>
</head>

<body id="mainBody">
    <div id="buttons">
        <h1><!--Stock Market MQTT Monitor--></h1>
        <button type="button" class="debug" onclick="displaySpreadsheet()">Spreadsheet</button>
        <button type="button" class="debug" onclick="displayGauges()">Gauges</button>

        <button type="button" class="debug" onclick="displayOverview()">Overview</button>
        <button type="button" class="debug" onclick="displayIndexes()">Indexes</button>

        <button type="button" class="debug" onclick="playDummy()">Play Dummy</button>
        <button type="button" class="debug" onclick="playCorona()">Play Corona</button>

        <button type="button" class="debug" onclick="displaySlideshow()">Slideshow</button>
        <button type="button" class="debug" onclick="stopAudio()">Stop Audio</button>

        <button type="button" class="debug" onclick="volumeUp()">Volume UP</button>
        <button type="button" class="debug" onclick="volumeDown()">Volume DOWN</button>

        <button type="button" class="debug" onclick="sayCondition()">Say Condition</button>

        <button type="button" class="debug" onclick="startConnect()">Connect</button>
        <button type="button" class="debug" onclick="getMqttBinary()">Get MQTT Binary</button>
        <button type="button" class="debug" onclick="displayConnections()">Connections</button>
        <button type="button" class="debug" onclick="displayDialog()">Dialog</button>

        <input type="checkbox" class="debug" value="Boat" />Ignore Remote Display Commands</input>
    </div>


    <img id="ItemPreview" class="previewClass" src="" />

    <img id="picOne" class="imgClass" src="" />
    <img id="picTwo" class="imgClass" src="" />






    <div id='alrt' class="alertClass" style="visibility:hidden"></div>
    <!--   <div id="status">Connection Status: Not Connected</div>-->
    <!--<video id="myVideo" width="320" height="240" controls=controls class="videoClass">-->
    <!--<source src="Mafia.mp4" type="video/mp4" />-->
    <!--<source src="Sustitute2.mp4" type="video/mp4" />-->
    <!--<source src="movie.ogg" type="video/ogg" />-->
    <!--Your browser does not support the video tag.
    </video>
    <br />-->
    <!-- <div>Here is the rest of the page. Hopefully we can get the value from the dialog form?! Should display <span class="myTarget">here</span> when finished.</div>-->


    <div id="dialog" title="Commands">

        <p>Use Buttons To Control.</p>

        <button type="button" onclick="displaySpreadsheet()">Spreadsheet</button>
        <button type="button" onclick="displayGauges()">Gauges</button>

        <button type="button" onclick="displayOverview()">Overview</button>
        <button type="button" onclick="displayIndexes()">Indexes</button>

        <button type="button" onclick="playDummy()">Play Dummy</button>
        <button type="button" onclick="playCorona()">Play Corona</button>

        <button type="button" onclick="displaySlideshow()">Slideshow</button>
        <button type="button" onclick="stopAudio()">Stop Audio</button>

        <button type="button" onclick="volumeUp()">Volume UP</button>
        <button type="button" onclick="volumeDown()">Volume DOWN</button>

        <button type="button" onclick="sayCondition()">Say Condition</button>

        <!--    <button type="button" onclick="startConnect()">Connect</button>-->
        <!--     <button type="button" onclick="getMqttBinary()">Get MQTT Binary</button>-->
        <!--    <button type="button" onclick="displayConnections()">Connections</button>-->


        <hr />
        <input type="checkbox" />Ignore Remote Display Commands</input>
        <hr />
        Enter User Name (Optional)
        <br />
        <input id="idInput" class="myInput" type="text" />
        <!--    <button class="formSaver">Save me!</button>-->
    </div>





    <!--  <button id="opener">Open Dialog</button>-->
    <!--<table>
        <tr>
            <td id="subscribe" width="300">
                <form name="subs" action="" onsubmit="return sub_topics()">
                    Subscribe Topic: <input type="text" name="Stopic" /><br />
                    Subscribe QOS: <input type="text" name="sqos" value="0" /><br />
                    <input type="submit" value="Subscribe" />
                </form>
            </td>
            <td id="publish" width="300">
                <form name="smessage" action="" onsubmit="return send_message()">
                    Message: <input type="text" name="message" /><br /><br />
                    Publish Topic: <input type="text" name="Ptopic" /><br /><br />
                    Publish QOS: <input type="text" name="pqos" value="0" /><br />
                    Retain Message: <input type="checkbox" name="retain" value="true" /><br />
                    <input type="submit" value="Submit" />
                </form>
            </td>
        </tr>
    </table>-->
    <!--Status Messages:
    <div id="status_messages">
    </div>-->
    <!--Received Messages:-->

    <div id="out_messages" class="outMessages">
    </div>
    <script>


        $('#picOne').fadeOut(1500);
        $('#picTwo').fadeOut(1500);

                                                                                                                                                                                                                                           ////////////////        //var yyy = bytes.length;


        /*

                    function saySomething(whatToSay) {
                        const synth = window.speechSynthesis;
                        // enter your voice here, because voices list loads asynchronously.. check the console.log below.
                        getVoice("Google US English", synth)
                            .then(voice => {
                                var utterThis = new SpeechSynthesisUtterance(whatToSay);
                                utterThis.voice = voice;
                                synth.speak(utterThis);
                            })
                            .catch(error => console.log("error: ", error));
                    }

                    function getVoice(voiceName, synth) {
                        return new Promise((resolve, reject) => {
                            synth.onvoiceschanged = function () {
                                const voices = synth.getVoices();

                                //		console.log("see all available languages and voices on your system: ", voices);

                                for (let i = 0; i < voices.length; i++) {
                                    //	console.log(voices[i].name)
                                    if (voices[i].name == voiceName) {
                                        resolve(voices[i]);
                                    }
                                }
                            }
                            synth.getVoices();
                        });
                    }



                    function playSound(url) {
                        var audio = document.createElement('audio');
                        audio.style.display = "none";
                        audio.src = url;
                        audio.autoplay = true;
                        audio.onended = function () {
                            audio.remove() //Remove when played.
                        };
                        audio.onerror = function () {
                            alert("playSound Error")
                        }
                        document.body.appendChild(audio);
                    }

            */





                                                                                                                                                                                                                                                                                    //	saySomething("Mu ha ha! Works now.");




        /*
                    try {
                        // Fix up for prefixing
                        window.AudioContext = window.AudioContext || window.webkitAudioContext;
                        context = new AudioContext();
                    }
                    catch (e) {
                        alert('Web Audio API is not supported in this browser');
                    }
                }
        */






        /*       function MQTTconnect() {
                   var clean_sessions = document.forms["connform"]["clean_sessions"].value;
                   var user_name = document.forms["connform"]["username"].value;
                   console.log("clean= " + clean_sessions);
                   var password = document.forms["connform"]["password"].value;

                   if (clean_sessions = document.forms["connform"]["clean_sessions"].checked)
                       clean_sessions = true
                   else
                       clean_sessions = false

                   document.getElementById("status_messages").innerHTML = "";
                   var s = document.forms["connform"]["server"].value;
                   var p = document.forms["connform"]["port"].value;
                   if (p != "") {
                       port = parseInt(p);
                   }
                   if (s != "") {
                       //host=s;
                       //	console.log("host");
                   }

                   console.log("connecting to " + host + " " + port + " clean session=" + clean_sessions);
                   console.log("user " + user_name);
                   document.getElementById("status_messages").innerHTML = 'connecting';
                   mqtt = new Paho.MQTT.Client(host, port, "clientjsaaa");
                   //document.write("connecting to "+ host);
                   var options = {
                       timeout: 3,
                       cleanSession: clean_sessions,
                       onSuccess: onConnect,
                       onFailure: onFailure,

                   };
                   if (user_name != "")
                       options.userName = document.forms["connform"]["username"].value;
                   if (password != "")
                       options.password = document.forms["connform"]["password"].value;

                   mqtt.onConnectionLost = onConnectionLost;
                   mqtt.onMessageArrived = onMessageArrived;
                   //mqtt.onConnected = onConnected;

                   mqtt.connect(options);
                   return false;
               }
       */



    </script>
</body>
</html>